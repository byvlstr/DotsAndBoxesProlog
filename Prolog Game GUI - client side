<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Dots and boxes</title>
<style type="text/css">
body {
	font-family:"helvetica neue";
	color:#393939;
}
table {
	width:600px;
	height:600px;
}
table td { 
	width:200px;
	height:200px;
	position: relative;
}
.point {
	position: absolute;
	width: 20px;
	height: 20px;
	background-color: rgb(5, 160, 255);
	z-index: 10;
	border-radius: 50%;
}
.border {
	background-color: #FAFAFA;
	cursor:pointer;
	transition:0.3s ease all;
}
.border:hover {
	background-color: #5e4448;
	transition:0.3s ease all;
}
.border.on {
	background-color: rgb(5, 160, 255);
	cursor:none;
}
.border.left {
	width: 8px;
	height: 100%;
	position: absolute;
	top: 0;
	left: 0;
}
.border.top {
	width: 100%;
	height: 8px;
	position: absolute;
	top: 0;
	left: 0;
}
.border.right {
	width: 8px;
	height: 100%;
	position: absolute;
	top: 0;
	right: 0;
}
.border.bottom {
	width: 100%;
	height: 8px;
	position: absolute;
	bottom: 0;
	left: 0;
}
.score.left {
	float: left;
	width: 25%;
	text-align: right;
	color: rgb(5, 160, 255);
}
.score.right {
	float: right;
	width: 25%;
	text-align: left;
	color: rgb(255, 95, 78);
}
.border.user {
	background-color: rgb(5, 160, 255);
}
.border.computer {
	background-color: rgb(255, 95, 78);
}
</style>

<script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script type="text/javascript">
var currentPlayer = "user";
var currentBoard = [0,0,0,0,0,0,0,0,0];

$(document).on("click", ".border:not(.on)", function() {
	
	action = $(this).attr("class").split(" ")[1];
	index = $(this).parent().attr("id");
	
	move(index, action);
});


function move(index, action) {
	jQuery.ajax({
		url: 'http://localhost:5000/game',
		data: {
			"turnIndex" : index,
			"turnAction" : action,
			"boardv1" : currentBoard[0],
			"boardv2" : currentBoard[1],
			"boardv3" : currentBoard[2],
			"boardv4" : currentBoard[3],
			"boardv5" : currentBoard[4],
			"boardv6" : currentBoard[5],
			"boardv7" : currentBoard[6],
			"boardv8" : currentBoard[7],
			"boardv9" : currentBoard[8],
			"score" : $("#score_"+currentPlayer).text(),
			"user" : currentPlayer
		},
		type:"GET",
		dataType: 'JSON',
		success: function(data) {
			
			currentBoard = data.board;
			
			for(i = 0; i < 9; i++) {
				bin = parseInt(currentBoard[i], 10).toString(2);
				bin = pad(bin, 4);
				bin = bin.split("");
				
				if(bin[0] == 1 && !$("td#"+i).find(".bottom").hasClass("on"))
					$("td#"+i).find(".bottom").addClass("on "+ currentPlayer);
					
				if(bin[1] == 1 && !$("td#"+i).find(".left").hasClass("on"))
					$("td#"+i).find(".left").addClass("on "+ currentPlayer);
					
				if(bin[2] == 1 && !$("td#"+i).find(".top").hasClass("on"))
					$("td#"+i).find(".top").addClass("on "+ currentPlayer);
					
				if(bin[3] == 1 && !$("td#"+i).find(".right").hasClass("on"))
					$("td#"+i).find(".right").addClass("on "+ currentPlayer);
			}
			
			$("#score_"+currentPlayer).text(data.score);
			
			if(parseInt($("#score_user").text()) + parseInt($("#score_computer").text())  == 9) {
				if(parseInt($("#score_user").text()) > parseInt($("#score_computer").text()))
					alert("Bravo ! Vous avez gagné !");
				else
					alert("L'ordinateur a gagné...");
				
				return;
			}
			
			currentPlayer = data.next_player;
			
			if(currentPlayer == "computer")
				move(0,0);
		}
	});
}

function pad (str, max) {
  str = str.toString();
  return str.length < max ? pad("0" + str, max) : str;
}
</script>

</head>
<div class="score left">
	<h2>Vous</h2>
      <p id="score_user">0</p>
</div>
<div class="score right">
	<h2>Ordinateur</h2>
      <p id="score_computer">0</p>
</div>

<table border="0" cellspacing="0" align="center">
	<tr>
      	<td id="0">
            	<div class="point" style="left: -5px;top: -5px;"></div>
                  
            	<div class="border left"></div>
            	<div class="border top"></div>
            	<div class="border right"></div>
            	<div class="border bottom"></div>
             </td>
      	<td id="1">
            	<div class="point" style="left: -13px;top: -6px;"></div>
                  
            	<div class="border top"></div>
            	<div class="border right"></div>
            	<div class="border bottom"></div>
            </td>
      	<td id="2">
            	<div class="point" style="left: -13px;top: -6px;"></div>
            	<div class="point" style="right: -5px;top: -6px;"></div>
      
            	<div class="border top"></div>
            	<div class="border right"></div>
            	<div class="border bottom"></div>
           </td>
      </tr>
	<tr>
      	<td id="3">
            	<div class="point" style="left: -5px;top: -13px;"></div>
                  
            	<div class="border left"></div>
            	<div class="border right"></div>
            	<div class="border bottom"></div>
             </td>
      	<td id="4">
            	<div class="point" style="left: -13px;top: -13px;"></div>
                  
            	<div class="border right"></div>
            	<div class="border bottom"></div>
            </td>
      	<td id="5">
            	<div class="point" style="left: -13px;top: -13px;"></div>
            	<div class="point" style="right: -5px;top: -13px;"></div>
                  
            	<div class="border right"></div>
            	<div class="border bottom"></div>
           </td>
      </tr>
	<tr>
      	<td id="6">
            	<div class="point" style="left: -5px;top: -13px;"></div>
            	<div class="point" style="left: -5px;bottom: -5px;"></div>
                  
            	<div class="border left"></div>
            	<div class="border right"></div>
            	<div class="border bottom"></div>
             </td>
      	<td id="7">
            	<div class="point" style="left: -13px;top: -13px;"></div>
            	<div class="point" style="left: -13px;bottom: -5px;"></div>
                  
            	<div class="border right"></div>
            	<div class="border bottom"></div>
            </td>
      	<td id="8">
            	<div class="point" style="left: -13px;top: -13px;"></div>
            	<div class="point" style="right: -5px;top: -13px;"></div>
            	<div class="point" style="left: -13px;bottom: -5px;"></div>
            	<div class="point" style="right: -5px;bottom: -5px;"></div>
                  
            	<div class="border right"></div>
            	<div class="border bottom"></div>
           </td>
      </tr>
</table>
<body>
</body>
</html>
